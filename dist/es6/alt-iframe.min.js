/**
 * alt-iframe
 * - A simple native JavaScript (ES6+) utility library to include partial HTML(s).
 * - You don't need a framework or jQuery!!!
 *
 * version: 1.3.0
 *
 * License: MIT
 *
 * USAGE:
 * see example at https://github.com/FrontEndNeo/alt-iframe
*/
(function(t){function e(t,e){return e="string"==typeof e&&y.querySelector(e)||e||y,Array.prototype.slice.call(e.querySelectorAll(t))}function r(t,e,r){t.setAttribute(r,t.getAttribute(e)),t.removeAttribute(e)}function i(t){let e=y.createElement("script");e.text=t.innerHTML;for(let r=t.attributes.length-1;r>=0;r--)e.setAttribute(t.attributes[r].name,t.attributes[r].value);return e}function n(t,n){e("x-script:not([processed])",t).forEach(t=>{t.setAttribute("processed",""),n&&t.setAttribute("await","");let e=i(t);if(e.hasAttribute("src")){let i=!e.hasAttribute("await");!n&&i?t.parentNode.replaceChild(e,t):(r(t,"src","x-src"),u(e))}else t.parentNode.replaceChild(e,t)})}function a(){let t,e=(y.body.getAttribute("hash-error")||"").toLowerCase(),r=v.origin+v.pathname+v.search;"alert"==e?(t="Page route["+A.substring(1)+"] not found! Redirecting to this page root.",alert(t)):"url"==e&&(t="Page_route["+A.substring(1)+"]_not_found!_Redirected_to_this_page_root.",r=v.origin+v.pathname+"?_error="+t+v.search.replace(/^\?/,"&")),v.href=r}function s(){if(A){let t=e('[x-href="'+A+'"][x-target^="#"]');t.length?(A="",m=x,t[0].click()):!w&&!b().length&&a()}else{let t=e("[skip-on-hash]");t.length&&(t.forEach(t=>{t.removeAttribute("skip-on-hash")}),g())}}function o(t,e){w--;let r=t.getAttribute("x-js");if(r&&(e+='<script src="'+r+'"></script>',t.removeAttribute("x-js")),"SCRIPT"==t.tagName){if(e.trim()){let t=y.createElement("script");t.id=(new Date).getMilliseconds(),t.text=e,y.head.appendChild(t).parentNode.removeChild(t)}}else if(e=(e||"").replace(/<(\/)*script/gi,"<$1x-script"),t.tagName.indexOf("REPLACE")>=0||t.hasAttribute("replace")){let r=t.parentNode,i=t.hasAttribute("await");t.outerHTML=e,n(r,i),g(r)}else t.innerHTML=e,n(t,t.hasAttribute("await")),g(t);s()}function c(t){let e=(t||"").trim(),r=/\+$/.test(e)?"+":"";return r&&(e=e.substring(0,e.length-1)),d&&(e=/^[^a-z0-9_]/gi.test(e[0])?e.substring(1):d+"/"+e),f&&(e="/"==e[e.length-1]?e.substring(0,e.length-1):e+f),e+r}function u(t,e){e=c(e||t.getAttribute("src")),t.setAttribute("x-src",e),t.removeAttribute("src"),e&&(w++,/\+$/.test(e)&&(//appendScript
t.setAttribute("x-js",e.replace(/\.[a-z]{3,4}\+$/,".js")),e=e.substring(0,e.length-1)),t.hasAttribute("await")?(async()=>{const r=await fetch(e).catch(t=>null);r&&r.ok&&o(t,await r.text())})():fetch(e).then(t=>t.text()).then(e=>o(t,e)).catch(t=>null))}function l(t){if(m!=t){m=t;try{history.pushState(null,t,t)}catch(t){}}}function h(){let t=this,e=y.querySelector(t.getAttribute("x-target"));if(e){e[t.hasAttribute("replace")?"setAttribute":"removeAttribute"]("replace",""),t.hasAttribute("await")&&e.setAttribute("await",""),t.hasAttribute("async")&&e.removeAttribute("await","");let r=t.getAttribute("x-href").substring(1);/^[#! ]/.test(r)?r=r.substring(1).trim():l("#"+r),u(e,r)}else console.warn("Target element not found. Invalid target specified in element",t)}function b(t){return t=t||y,e("[src]"+"audio embed iframe img input script source track video x-script [processed] [skip-on-hash]".split(" ").map(function(t){return":not("+t+")"}).join(""),t)}function g(t){t=t||y,b(t).forEach(t=>{t.setAttribute("processed",""),u(t)}),e('[href^="#"][target^="#"]',t).forEach(t=>{r(t,"target","x-target"),r(t,"href","x-href"),t.setAttribute("href","javascript:;"),t.addEventListener("click",h)})}function p(){w=0,A=v.hash||"",d=(y.body.getAttribute("components-loc")||"").replace(/\/+$/g,"").trim(),f=(y.body.getAttribute("components-ext")||"").trim(),g()}let d,f,A,m,x,w,y=document,v=y.location;window.onhashchange=function(){x=v.hash||"",x?x!=m&&(A=x,s()):v.reload()},"complete"==y.readyState||"loading"!=y.readyState&&!y.documentElement.doScroll?p():y.addEventListener("DOMContentLoaded",p)})();