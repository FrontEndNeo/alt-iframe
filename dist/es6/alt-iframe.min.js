/**
 * alt-iframe
 * - A simple native JavaScript (ES6+) utility library to include partial HTML(s).
 * - You don't need a framework or jQuery!!!
 *
 * version: 1.8.0-ES6
 *
 * License: MIT
 *
 * USAGE:
 * see example at https://github.com/FrontEndNeo/alt-iframe
*/
(function(t){function e(t,e){return e="string"==typeof e&&C.querySelector(e)||e||C,Array.prototype.slice.call(e.querySelectorAll(t))}function r(t,e,r){t.setAttribute(r,t.getAttribute(e)),t.removeAttribute(e)}function i(t){let e=C.createElement("script");e.text=t.innerHTML;for(let r=t.attributes.length-1;r>=0;r--)e.setAttribute(t.attributes[r].name,t.attributes[r].value);return e}function n(t,e,r){let i,n,s,o,a=oldSrc=(t.getAttribute(e)||"").trim();2===arguments.length&&(r=t.closest("[x-src]")),a&&r&&!/^(\/\/|http:\/\/|https:\/\/)/i.test(a)&&(i=E.replace(/^\/+/,""),n=new RegExp("^((.){0,2}/)*"+i),n.test(a)?a=a.replace(n,E):"/"!==a[0]&&(s=r&&r.getAttribute("x-src")||"",o=s.substring(0,s.lastIndexOf("/")+1)||E+"/",a=(o+a).replace(/\/\.?\//,"/"))),a!==oldSrc&&console.log(a,oldSrc),a!==oldSrc&&t.setAttribute(e,a)}function s(t,s){e("script:not([processed])",t).forEach(t=>{t.setAttribute("processed",""),s&&t.setAttribute("await","");let e=i(t);if(e.hasAttribute("src")){n(e,"src",t.closest("[x-src]"));let i=e.getAttribute("src");!/\.js$/i.test(i)&&e.setAttribute("src",i+".js");let o=!e.hasAttribute("await");!s&&o?t.parentNode.replaceChild(e,t):(r(t,"src","x-src"),f(e))}else t.parentNode.replaceChild(e,t)})}function o(t){e('link[rel="stylesheet"][href]:not([processed])',t).forEach(function(t){n(t,"href"),t.setAttribute("processed","")}),e("img[src]:not([processed])",t).forEach(function(t){n(t,"src"),t.setAttribute("processed","")})}function a(){let t,e=(C.body.getAttribute("hash-error")||"").toLowerCase(),r=N.origin+N.pathname+N.search;"url"==e?(t="Page_route["+k.substring(1)+"]_not_found!_Redirected_to_this_page_root.",r=N.origin+N.pathname+"?_error="+t+N.search.replace(/^\?/,"&")):(t="Page route[#"+k.substring(1)+"] not found! Redirecting to this page root.",alert(t)),N.href=r}function l(t,r){if(F)if(t=t||k,t){let i=e('[url-hash="'+t+'"][x-target^="#"],[href="'+t+'"]');if(i.length)r&&i[0].setAttribute("skip-hash-update","1"),(!r||T&&r==k)&&(k=""),R=S,p.call(i[0],!0,r);else if(!O)if(k.indexOf(j)>0){let t=(M&&M.split(j)||[]).length,r=L[t];r||t<=L.length?(M+=(M?j:"")+r,T=e('[url-hash="'+M+'"][x-target^="#"]').length?0:250,setTimeout(()=>{l(M,k)},T)):a()}else if(!b().length){let t=C.querySelector(k);t?(t.scrollIntoView(!0),k=""):a()}}else{let t=e("[skip-on-hash]");t.length&&(t.forEach(t=>{t.removeAttribute("skip-on-hash")}),d())}}function u(t,e){O--;let r=t.getAttribute("x-js");if(r&&(e+='<script src="'+r+'"></script>',t.removeAttribute("x-js")),"SCRIPT"==t.tagName){if(e.trim()){let t=C.createElement("script");t.id=(new Date).getMilliseconds(),t.text=e,C.head.appendChild(t).parentNode.removeChild(t)}}else{let r=t.hasAttribute("replace")||t.tagName.indexOf("REPLACE")>=0,i=r?t.parentNode:t,n=r?"outerHTML":"innerHTML",a=t.hasAttribute("await");e=e||"",t[n]=e,o(i),s(i,a),d(i)}l()}function c(t){if("?"===E&&t.indexOf("/")>=0){let e=t.indexOf("/"),r=t.indexOf("/",e+1);E=("/"===t[0]||"."===t[0])&&r>e?t.substring(0,r):t.substring(0,e),console.log("Components Root Folder:",E)}}function h(t){let e,r,i=(t||"").trim(),n="";return/^(\/\/|http:\/\/|https:\/\/)/i.test(i)||(n=/\+$/.test(i)?"+":"",n&&(i=i.substring(0,i.length-1)),c(i),E&&(/^[^a-z0-9_\.\/]/gi.test(i[0])?i=i.substring(1):(e=E.replace(/^\/+/,""),r=new RegExp("^((.){0,2}/)*"+e),i=r.test(i)?i.replace(r,E):(E+"/"+i).replace(/\/\.?\//,"/"))),v&&!new RegExp(v+"$").test(i)&&(i="/"==i[i.length-1]?i.substring(0,i.length-1):i+v)),i+n}function f(t,e){e=h(e||t.getAttribute("src")),t.setAttribute("x-src",e),t.removeAttribute("src"),e&&(O++,/\+$/.test(e)&&(//appendScript
t.setAttribute("x-js",e.replace(/\.[a-z]{3,4}\+$/,".js")),e=e.substring(0,e.length-1)),t.hasAttribute("await")?(async()=>{const r=await fetch(e).catch(t=>null);r&&r.ok&&u(t,await r.text())})():fetch(e).then(t=>t.text()).then(e=>u(t,e)).catch(t=>null))}function g(t){if(F){if(!t.getAttribute("skip-hash-update")){let e=t.getAttribute("url-hash");if("#"!=e&&R!=e){R=e;try{history.pushState(null,e,e)}catch(t){}}}t.removeAttribute("skip-hash-update")}}function p(t,e){let r=this;if(t&&e&&"FORM"!==r.tagName)return void r.click();if("FORM"==r.tagName&&!r.checkValidity())return r.reportValidity(),!1;let i=r.getAttribute("if");if(i){let t=i.indexOf("("),e=(t>0?i.substring(0,t):i).replace(/\s/g,"");if(e){let t;try{t=window[e].call(r)}catch(t){console.error("Function NOT Found:",e)}if(!t)return!1}}let n=C.querySelector(r.getAttribute("x-target"));if(n){n[r.hasAttribute("replace")?"setAttribute":"removeAttribute"]("replace",""),r.hasAttribute("await")&&n.setAttribute("await",""),r.hasAttribute("async")&&n.removeAttribute("await",""),g(r);let t=r.getAttribute("x-href").substring(1);/^[! ]/.test(t)&&(t=t.substring(1).trim()),f(n,t)}else console.warn("Target element not found. Invalid target specified in element",r)}function b(t){return t=t||C,e("[src]"+"audio embed iframe img input script source track video [processed] [skip-on-hash]".split(" ").map(function(t){return":not("+t+")"}).join(""),t)}function d(t){t=t||C;let i=b(t);i.forEach(t=>{t.setAttribute("processed",""),f(t)}),e("form:not([onsubmit]):not([href])",t).forEach(t=>{!t.getAttribute("action")&&t.setAttribute("onsubmit","return false;")}),e('[href^="#"][target^="#"]',t).forEach(t=>{r(t,"target","x-target"),r(t,"href","x-href"),t.setAttribute("href","javascript:;");let e=t.getAttribute("url-hash")||t.getAttribute("x-href");!/^#/.test(e)&&(e="#"+e),/^#[! ]+/.test(e)&&(e="#"),e=e.replace(/[+ ]/g,"").replace(new RegExp("\\"+j+"+$"),""),t.setAttribute("url-hash",e);let i="FORM"==t.tagName,n=i?"submit":"click",s=(t.getAttribute("on")||n).replace(/[^a-z]/gi,"_");i&&!t.getAttribute("onsubmit")&&t.setAttribute("onsubmit","return false;"),s.split("_").forEach(e=>{e=e.trim().toLowerCase(),e.length>2&&(e=e.replace(/^on/,""),t.addEventListener(e,p))})}),!i.length&&y()}function A(t,e){return fetch(t).then(e=>{let r=e.status;return e.ok&&(r>=200&&r<300||304==r)?e.json():{error:"Failed: [GET]"+t,status:r}}).then(t=>e(t)).catch(r=>e({error:"Failed: [GET]"+t,e:r}))}function m(t,r,i){let n=e(r)[0];n?("function"==typeof i&&$.push(i),f(n,t)):console.error("Target container not found.",r)}function x(t,e){"function"==typeof t&&($.push({fn:t,delay:e||0}),y())}function y(t){O||b().length||!$.length||void 0!==t&&!t||(_=$.shift(),setTimeout(()=>{let e=_.fn(t);void 0!==e&&!e&&($=[]),y(e)},_.delay))}function w(){O=0,k=N.hash||"",L=F&&k&&k.split(j)||[],E=(C.body.getAttribute("components-loc")||"").replace(/^\.\//,"").replace(/\/+$/g,"").trim(),v=(C.body.getAttribute("components-ext")||"").trim(),d(),setTimeout(function(){new MutationObserver(t=>{t&&t[0]&&"childList"===t[0].type&&t[0].target&&d(t[0].target)}).observe(C,{childList:!0,subtree:!0})})}let E,v,O,k,R,S,L,T,_,C=document,N=C.location,j="/",M="",F="off"!=(C.body.getAttribute("url-hash")||"").toLowerCase(),$=[];F&&(window.onhashchange=function(){S=N.hash||"",S?S!=R&&(k=S,l()):(N.href.indexOf("#")<0&&N.reload(),R="#")}),"complete"==C.readyState||"loading"!=C.readyState&&!C.documentElement.doScroll?w():C.addEventListener("DOMContentLoaded",w),t.alt=t.aif={load:m,onReady:x,getData:A}})(this);